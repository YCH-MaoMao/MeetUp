{% extends "Meetup/base.html" %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/chat.css' %}">

<div class="chat-container">
    <h2>Your Conversations</h2>
    <a href="{% url 'create_conversation' %}" class="new-chat-btn">Start New Conversation</a>
    
    <ul class="conversation-list">
        {% for item in conversations_with_counts %}  <!-- for loop to iterate through the conversations -->
        <li class="conversation-item">
            <a href="{% url 'conversation_detail' item.conversation.id %}" class="conversation-link">
                <div class="participants">
                    {% for participant in item.conversation.participants.all %}  <!-- for loop to iterate through the participants -->
                        {% if participant != user %}  <!-- if the participant is not the user -->
                            {{ participant.username }}  <!-- display the participant username -->
                        {% endif %}
                    {% endfor %}
                </div>
                {% with last_message=item.conversation.messages.last %}  <!-- get the last message -->
                {% if last_message %}  <!-- if the last message exists -->
                <div class="last-message">
                    {{ last_message.sender.username }}: {{ last_message.content|truncatechars:50 }}  <!-- display the last message sender username and content -->
                </div>
                {% endif %}
                {% endwith %}
            </a>
            {% if item.unread_count > 0 %}  <!-- if the number of unread messages is greater than 0 -->
            <span class="unread-badge" id="unread-badge-{{ item.conversation.id }}">{{ item.unread_count }}</span>
            {% else %}  <!-- if the number of unread messages is not greater than 0 -->
            <span class="unread-badge" id="unread-badge-{{ item.conversation.id }}" style="display: none;">0</span>
            {% endif %}
        </li>
        {% empty %}
        <li class="conversation-item">
            No conversations yet. Start one by clicking the button above!
        </li>
        {% endfor %}
    </ul>
</div>

<script src="{% static 'js/chat.js' %}"></script>
{% endblock %} 